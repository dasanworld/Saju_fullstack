# Requirements: 사주 팔자 

## 개요: 
Clerk, Supabase, 토스페이먼츠, Gemini API를 연동하여 사주 팔자 SaaS를 만든다.

## 페이지 구성:
- 메인 페이지: 랜딩페이지
- 대시보드(분석 목록): 과거에 수행한 사주팔자 검사 내역을 확인한다.
- 새 검사(새 분석하기): 사주 팔자 검사를 위한 정보를 입력받는다. 
- 분석 상세보기: 분석에 대한 상세한 내용을 표시해 줍니다. 
- 구독 관리:현재 구독 정보 카드와 한 단계 업그레이드를 유도하는 카드를 포함한다.

## 구독 정책:
- 무료 가입 유저는 최초 3회만 테스트 가능합니다. (`gemini-2.5-flash` 사용)
- Pro 요금제 구독 고객은 월 10회 테스트 가능합니다. (`gemini-2.5-pro` 사용)
- Pro 요금제 취소 시, 다음 결제일까지 구독 상태가 유지됩니다.
- Pro 요금제 취소 시, 다음 결제일전에 취소상태를 취소할 수 있습니다.
- 구독 해지와 동시에 빌링키를 삭제합니다. 다시 구독하려면 SDK를 통한 재발급이 필요합니다.

## 기능:
홈 이외의 페이지는 인증 상태로만 접근 가능합니다.
인증 관련 페이지는 모두 clerk SDK에서 기본적으로 제공되는 것을 사용합니다.
Clerk SDK/Webhook을 사용해야합니다.
Clerk Webhook은 서비스가 배포된 상태에서만 작동합니다!
- 인증(Google 로그인) - Clerk사용
- 토스페이먼츠 구독결제
- Gemini API 기반 사주분석
- 정기결제 trigger에 Supabase cron을 사용하세요.

##작동 플로우
1. [Supabase cron] 매일 02:00에 trigger, Next.js API 호출
2. [Next.js API] 유효한 호출인지 검증
3. [Next.js API] 오늘이 결제일인 구독건들 탐색 후 하나하나 결제API 호출
    1. 결제가 성공하면 테스트 횟수 추가 + 구독 기간 연장
    2. 결제가 실패하면 즉시 구독 해지

## 공통 nav(랜딩 페이지 제외)
- 좌측 상단에 Saju와 적절한 아이콘을 표시합니다.
- 좌측 글로벌 nav: 대시보드, 새검사
- 좌측 하단에는 메일과 잔영회수 그리고 구독을 알려줍니다.
- 모든 페이지는 notion 스타일을 적용합니다.


### 메인 페이지(랜딩페이지)
- 상단 헤더: 좌측 끝에는 Saju를 상장하는 아이콘과 "Saju피아"를 넣습니다. 우측 끝에는 "시작하기" 버튼을 넣습니다. 메뉴 중앙: 홈, 서비스, 가격, FAQ를 넣습니다. 
   

#### 상단 히어로 섹션
  1. Title: "AI가 풀어주는 당신의 사주팔자", 
  2. 그 아래 설명에는 "구글 Gemini AI가 천간·지지를 계산하고, 당신의 운세를 자연어로 풀어드립니다.
가입 즉시 무료 1회 체험, Pro 구독 시 월 10회 분석 제공" 
  3. "무료 시작하기"와 자세히 알아보기 버튼을 위치합니다.
  4. 멋진 대 자연의 이미지를 모서리 둥근 입체 이미지를 넣습니다. (리프레쉬시 매번 다른 이미지를 보여줍니다. 찾아서 보여줍니다.)

#### 첫번째 섹션
  1. Title: "Saju피아가 특별한 이유"
  2. 카드 3개에 장점 3가지를 만들어서 넣습니다. 예) AI기반 정확한 분석, 합리적인 가격, 검사 내역 영구 보관

#### 두번째 섹션 
  1. Title: "간단하고 명확한 요금제"
  2. 카드 2개, Free, Pro
    Free: 
    0 원 
    - 가입 즉시 1회 무료 검사
    - Gemini 2.5 Flash 모델 사용
    - 검사 내역 영구 보관
    - 마크다운 형식 분석 결과
    - "시작하기" 버튼
    Pro:
    3900원/월
    - 월 10회 고품질 검사
    - Gemini 2.5 Pro 모델 사용
    - 검사 내역 영구 보관
    - 마크다운 형식 분석 결과
    - 자동 결제 (결제일 기준 1개월)
    - "Pro 시작하기" 버튼
   3. 아래 문구를 추가한다.
    "* 구독 취소 시 환불 불가, 다음 결제일까지 서비스 이용 가능
    * 결제 실패 시 즉시 구독 해지 처리"

#### 세번째 섹션
title: 자주 묻는 질문
아래 질문에 대해 간단한 답변이 아래 삼각형을 클릭하면, 삼각형이 위로 돌아가며, 질문에 대한 답변이 보이게 한다. 
-무료 체험은 어떻게 사용하나요?
-Pro 구독은 어떻게 결제되나요?
-출생시간을 모르면 사주를 볼 수 없나요?
-구독을 취소하면 환불받을 수 있나요?
-검사 결과는 어디에서 확인하나요?
-Gemini Flash와 Pro 모델의 차이는 무엇인가요?


### 대시 보드
- 상단 헤드에 "과거에 수행한 사주 팔자 검사 내역을 확인할 수 있습니다."를 넣는다.
- 그 아래 검색창에 이름을 넣어서 검색할수 있다("성함으로 검색하세요")
- 그 아래 표시: 총 N 건의 검사 내역
- 그 아래는 사주에 검색에 대한 카드가 표시된다.
   - 각 카드를 클릭하면, "분석 상세보기" 페이지로 전환된다. 


### 새 검사
- 폼으로 아래와 같은 내용을 각각 입력받는다.
    1. 이름
    2. 생년 월일(캘린더 아이콘): 캘린더 아이콘 클릭시, default 오늘 현재의 날짜를 표시하고, 클릭하면 반영한다. 새롭게 작성하는 것이 아니라 이미 작성된 모듈을 사용한다.
    3. 출생 시간(시간 아이콘): 시간 아이콘 클릭시, 오전/ 오후 12시간 체례를 보여준다.    
    4. 출생 시간 폼 아래 체크박스를 넣고, "출생 시간 모름"을 체크할 수 있다.
    5. 성별: 둥근 체크 - 남성/ 여성 
    6. 검사 시작 버튼 바를 넣는다. : 검사 시작을 누르면, 폼 내용을 DB에 저장하며, Gemini api를 통해 시스템 프롬프트와 함께 전송한다.


### 분석 상세보기
- 사주 카페 분위기를 연출해 봅니다.
- 사주 팔자를 보는 사람의 정보를 가지런히 표시합니다.
- 사주 팔자에 대한 분석 내용을 알려줍니다.


### 외부 연동 참고
/docs/external/fullstackIntegration.md


### 사주 system 프롬프트

import type { TestInput } from '@/types/test';

export const generateSajuPrompt = (input: TestInput): string => {
  return `당신은 20년 경력의 전문 사주팔자 상담사입니다.

**입력 정보**:
- 성함: ${input.name}
- 생년월일: ${input.birthDate}
- 출생시간: ${input.birthTime || '미상'}
- 성별: ${input.gender === 'male' ? '남성' : '여성'}

**분석 요구사항**:
1️⃣ 천간(天干)과 지지(地支) 계산
2️⃣ 오행(五行) 분석 (목, 화, 토, 금, 수)
3️⃣ 대운(大運)과 세운(歲運) 해석
4️⃣ 전반적인 성격, 재운, 건강운, 연애운 분석

**출력 형식**: 마크다운

**금지 사항**:
- 의료·법률 조언
- 확정적 미래 예측
- 부정적·공격적 표현`;
};

 